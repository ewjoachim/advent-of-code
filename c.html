<html>
<style>
body {font-family: sans-serif;}
ul { list-style-type: none; }
pre, div { 	box-sizing: border-box; display: inline-block; width: 45%; margin: 10px; border: 1px solid #ccc; background-color: #efefef; min-height: 50vH; overflow-y: auto; vertical-align: top; padding: 2em;}
pre { font-family: monospace;}


</style>
<body>
<pre>
eyr:1972 cid:100
hcl:#18171d ecl:amb hgt:170 pid:186cm iyr:2018 byr:1926

iyr:2019
hcl:#602927 eyr:1967 hgt:170cm
ecl:grn pid:012533040 byr:1946

hcl:dab227 iyr:2012
ecl:brn hgt:182cm pid:021572410 eyr:2020 byr:1992 cid:277

hgt:59cm ecl:zzz
eyr:2038 hcl:74454a iyr:2023
pid:3556412378 byr:2007

pid:087499704 hgt:74in ecl:grn iyr:2012 eyr:2030 byr:1980
hcl:#623a2f

eyr:2029 ecl:blu cid:129 byr:1989
iyr:2014 pid:896056539 hcl:#a97842 hgt:165cm

hcl:#888785
hgt:164cm byr:2001 iyr:2015 cid:88
pid:545766238 ecl:hzl
eyr:2022

iyr:2010 hgt:158cm hcl:#b6652a ecl:blu byr:1944 eyr:2021 pid:093154719
</pre>
<div>
</div>

<script	src="https://code.jquery.com/jquery-3.1.1.min.js"
		integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
		crossorigin="anonymous"></script>
<script>
$(document).ready(function() {

	// regroupement par passeport
	var lines = $('pre').html().split(/\n/)
	var content = ""
	for (var i=0; i<=lines.length; i++) {
		if (lines[i] != "") {
			content = content + " " + lines[i]	
		}
		else {
			$("div").append("<p>" + content + "</p>")
			content = ""
		}
	}

	var passeportID = 0
	var validPassport = 0

	// Regex
	var regex4digits = new RegExp("^([0-9]{4})$")
	var regexHeight = new RegExp("^([0-9]+[A-Za-z]{2})$")
	var regexHexaColor = new RegExp("^#([A-Fa-f0-9]{6})$")
	var regexLeadingZeros = new RegExp(/^[0-9]{9}$/);


	$("p").each(function() {
		passeportID = passeportID + 1
		var passport = {byr: "", iyr: "", eyr: "", hgt: "", hcl: "", ecl: "", pid: "", cid:""};


		for (var i = 0; i < $(this).text().split(" ").length; i++) {
			var thisSubstring = $(this).text().split(" ")[i]
			var thisKey = thisSubstring.substr(0, thisSubstring.indexOf(':'));
			var thisValue = thisSubstring.substr(thisSubstring.indexOf(":") + 1)
			if (thisKey == "byr") {Object.assign(passport, {byr: thisValue});}
			else if (thisKey == "iyr") {Object.assign(passport, {iyr: thisValue});}
			else if (thisKey == "eyr") {Object.assign(passport, {eyr: thisValue});}
			else if (thisKey == "hgt") {Object.assign(passport, {hgt: thisValue});}
			else if (thisKey == "hcl") {Object.assign(passport, {hcl: thisValue});}
			else if (thisKey == "ecl") {Object.assign(passport, {ecl: thisValue});}
			else if (thisKey == "pid") {Object.assign(passport, {pid: thisValue});}
			else if (thisKey == "cid") {Object.assign(passport, {cid: thisValue});}
		}

		if (passport.byr && passport.iyr && passport.eyr && passport.hgt && passport.hcl && passport.ecl && passport.pid) { 
			var issueSpotted = ''
			var checkedData = 0

			// verifs- BYR
			if (regex4digits.test(passport.byr) && passport.byr >= 1920 && passport.byr <= 2002) {
				checkedData = checkedData + 1
			}
			else {		
				issueSpotted = issueSpotted + "BYR "
			}

			// verif IYR
			if (regex4digits.test(passport.iyr) && passport.iyr >= 2010 && passport.iyr <= 2020) {
				checkedData = checkedData + 1
			}
			else {
				issueSpotted = issueSpotted + "IYR "
			}

			// verif EYR
			if (regex4digits.test(passport.eyr) && passport.eyr >= 2020 && passport.eyr <= 2030) {
				checkedData = checkedData + 1
			}
			else {				
				issueSpotted = issueSpotted + "EYR "
			}

			// verif HGT 
			// verif HGT
			if ((regexHeight.test(passport.hgt) && passport.hgt.indexOf("in") != -1 && parseInt(passport.hgt) >= 59 && parseInt(passport.hgt) <=76) ||
				(regexHeight.test(passport.hgt) && passport.hgt.indexOf("cm") != -1 && parseInt(passport.hgt) >= 150 && parseInt(passport.hgt) <=193)) {
				checkedData = checkedData + 1
			}
			else {				
				issueSpotted = issueSpotted + "HGT "
			}

			// verif HCL 
			if (regexHexaColor.test(passport.hcl)) {
				checkedData = checkedData + 1
			}
			else {				
				issueSpotted = issueSpotted + "HCL "
			}

			// verif ECL
			if (passport.ecl == "amb" || passport.ecl == "blu" || passport.ecl == "brn" || passport.ecl == "gry" || passport.ecl == "grn" || passport.ecl == "hzl" || passport.ecl == "oth") {
				checkedData = checkedData + 1
			}
			else {				
				issueSpotted = issueSpotted + "ECL "
			}

			// verif PID
			if (regexLeadingZeros.test(passport.pid)) {
				checkedData = checkedData + 1
			}
			else {				
				issueSpotted = issueSpotted + "PID "
			}	

		}
		else {			
			issueSpotted = "Missing data"
		}

		if (checkedData == 7) {
			validPassport = validPassport + 1
			console.log("Passport #" + passeportID + " âœ… - Total valid passports: " + validPassport)
		}

		else {
			console.log("Passport #" + passeportID + " ðŸš« (" + issueSpotted + ") - Total valid passports length: " + validPassport)
		}



	})



});
</script>
</body>
</html>